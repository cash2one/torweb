Title: 深入理解计算机操作系统
Date: 2015-10-29 01:00
Author: jmpews
Category: SCPP
Tags: c
Slug: scpp

### 3.4.2 数据传送指令

栈相关知识:

1. 栈向下增长
2. %ebp 栈底 %esp栈顶

#### push指令

```
push %eax

// 等价命令, 考虑好大端,小端
subl %4, %esp
movl %eax, (%esp)
```
#### pop指令

```
pop %eax

//等价命令
movl (%esp), %eax
addl %4, %esp

```

### 3.6.6 条件传送指令

传统是采用: **控制** 的条件转移

现代处理器: **数据** 的条件转移

现代处理器 采用流水线获得高性能(重叠连续指令的步骤)

注意: 并不是所有情况都可以采用数据条件转移

1. xp ? *xp : 0 (间接引用空指针)
2. xp ? (global_count++, xp) : 1 (修改了全局变量)
3. 存在大量计算


###  3.7 过程

##### 3.7.1 栈帧结构

%ebp 帧指针 (大多数信息访问是相对于帧指针)

%esp 栈指针 (栈指针是会改变的)

栈的结构向下增长

如何开始函数调用?

1. 存放下一个调用需要的形参
2. 保存返回地址 (call 的作用)
3. 修改%ebp, %esp (在新的函数需要在一开始执行的)
4. 在新%ebp的基础上存放局部变量和临时变量
5. 处理调用
6. leave 恢复%ebp 和 %esp
7. ret 返回保存的地址继续执行

#### 3.7.2 转移控制

call 的作用: 将返回地址入栈

```
leave

// 等价命令
movl %ebp, %esp
popl %ebp
```
